Version =20
VersionRequired =20
Begin Form
    PopUp = NotDefault
    RecordSelectors = NotDefault
    MaxButton = NotDefault
    MinButton = NotDefault
    ShortcutMenu = NotDefault
    AutoCenter = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    PictureSizeMode =1
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    DatasheetFontHeight =11
    ItemSuffix =60
    Left =3495
    Top =2490
    Right =28545
    Bottom =15015
    OnUnload ="[Event Procedure]"
    RecSrcDt = Begin
        0x889c6f9a77e9e340
    End
    Caption ="AddIndDetections"
    OnOpen ="[Event Procedure]"
    DatasheetFontName ="Calibri"
    FilterOnLoad =0
    DatasheetBackColor12 =16777215
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =16053492
    PictureSizeMode =4
    DatasheetGridlinesColor12 =15062992
    FitToScreen =1
    Begin
        Begin Label
            BackStyle =0
            TextFontFamily =18
            FontSize =10
            BorderColor =11644565
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Rectangle
            BackStyle =0
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Line
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Image
            BackStyle =0
            SizeMode =3
            PictureAlignment =2
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CommandButton
            TextFontFamily =18
            FontWeight =400
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =16118511
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin OptionButton
            LabelX =230
            LabelY =-30
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CheckBox
            LabelX =230
            LabelY =-30
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin OptionGroup
            BackStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin BoundObjectFrame
            SizeMode =3
            BackStyle =0
            LabelX =-1800
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin TextBox
            FELineBreak = NotDefault
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            AsianLineBreak =1
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            ShowDatePicker =1
        End
        Begin ListBox
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            AllowValueListEdits =1
            InheritValueList =1
        End
        Begin ComboBox
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            AllowValueListEdits =1
            InheritValueList =1
        End
        Begin Subform
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin UnboundObjectFrame
            BackStyle =0
            OldBorderStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CustomControl
            OldBorderStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin ToggleButton
            TextFontFamily =18
            FontWeight =400
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =16118511
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Tab
            FontSize =11
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Attachment
            BackStyle =0
            PictureSizeMode =3
            Width =4800
            Height =3840
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            LabelX =-1800
        End
        Begin FormHeader
            Height =585
            BackColor =6108695
            Name ="FormHeader"
            AutoHeight =1
            Begin
                Begin Label
                    OverlapFlags =85
                    TextAlign =1
                    TextFontFamily =34
                    Left =300
                    Top =60
                    Width =5910
                    Height =525
                    FontSize =18
                    BackColor =6108695
                    BorderColor =5029044
                    ForeColor =-2147483608
                    Name ="Auto_Title0"
                    Caption ="Assign Independent Detections"
                    FontName ="Trebuchet MS"
                    GridlineColor =0
                    LayoutCachedLeft =300
                    LayoutCachedTop =60
                    LayoutCachedWidth =6210
                    LayoutCachedHeight =585
                End
                Begin CommandButton
                    OverlapFlags =85
                    TextFontFamily =34
                    Left =6720
                    Top =120
                    Width =366
                    Height =366
                    Name ="cmdHelp"
                    Caption ="Help"
                    StatusBarText ="Help"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ControlTipText ="Help"
                    ImageData = Begin
                        0x2800000010000000100000000100200000000000000000000000000000000000 ,
                        0x000000000000000000000000000000000000000000000000e0e8e000e0c8b000 ,
                        0xe0d8d000e0d0c010e0d0c010d0d0c010d0d0c000d0d0d000e0e0e00000000000 ,
                        0x0000000000000000000000000000000000000000f0e8e0009068303080582080 ,
                        0x905010c0804820e0804820c0804810b06040108050381030d0c8c01000000000 ,
                        0x000000000000000000000000e0780000e0a05010a0683070c08860f0e0c8b0ff ,
                        0xf0f0f0fffffffffffffffffff0f0f0ffe0c8c0ffa07850c040301060d0c8c010 ,
                        0xe0d8d0000000000000000000e0882000b0703070e0a880fffff0e0ffe0b8a0ff ,
                        0xd08050ffc05820ffc05820ffd08050ffe0b8a0fff0e8e0ffb09070f050301060 ,
                        0xd0c8c000e0e0e00000000000b0783030d09870f0fff0e0ffe0a890ffc05010ff ,
                        0xc05010ffe0a890ffffffffffb04810ffb04810ffd0a080fff0f0e0ffa07050d0 ,
                        0x50381030d0d0d000f0f0f000b0784080f0d8c0fff0c8b0ffe05820ffd05810ff ,
                        0xd05010ffe08050ffe0a880ffc05010ffb04810ffb04810ffe0b8a0ffe0c8c0ff ,
                        0x50401080d0d0d010f0f0f000d08040e0fff8f0fff09870fff06020ffe05820ff ,
                        0xe05820fff0a890ffffffffffd05010ffc05010ffb05010ffc07850fff0f0f0ff ,
                        0x804020c0e0d0c000f0f0f000d08040f0ffffffffff7840ffff6830fff06820ff ,
                        0xf06020fff08850fffffffffff0c0b0ffc05820ffb05010ffb05820ffffffffff ,
                        0x804820e0e0d0c010f0f0f000d08850f0ffffffffff8050ffff7030ffff6830ff ,
                        0xff6830ffff6820fff09060fffff8f0fff0d8c0ffc05020ffc05820ffffffffff ,
                        0x804820e0e0d8d010f0f0f000d08050c0fff8f0ffffa880ffff7040ffff8850ff ,
                        0xffb090ffff7030fff06820fff09070fffffffffff08050ffd08860fffff0f0ff ,
                        0x805820b0e0d8d010f0f0f000c0804070f0d8c0ffffd0c0ffff7840ffff9870ff ,
                        0xffffffffffc8b0ffff9060ffffc8b0fffff8f0fff07840fff0c8b0ffe0c8b0ff ,
                        0x90602070e0c8b00000000000c0884030e0a070f0fff8f0ffffc0a0ffff7840ff ,
                        0xffb8a0fffff8f0fffffffffffff0e0ffff9870fff0b8a0fffff0e0ffc08850e0 ,
                        0xa0682030f0e8e0000000000000000000c0884060e0b8a0f0fff8f0ffffd0c0ff ,
                        0xffa880ffff8850ffff8850ffffa880fff0d0c0fffff0e0ffd0a880f0a0683060 ,
                        0xe0c0a00000000000000000000000000000000000c0884060e0a070f0f0d8c0ff ,
                        0xfff8f0fffffffffffffffffffff8f0fff0d8c0ffc09060e0a0703050f0b89000 ,
                        0x0000000000000000000000000000000000000000f0f0f000c0884030c0804070 ,
                        0xe0a070c0d09870e0d09860f0d09870d0b0784070b0784020f0e8f00000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0xf0f0f000f0f0f000f0f0f000f0f0f000f0f0f00000000000f0f0f00000000000 ,
                        0x0000000000000000
                    End
                    BackStyle =0

                    LayoutCachedLeft =6720
                    LayoutCachedTop =120
                    LayoutCachedWidth =7086
                    LayoutCachedHeight =486
                End
            End
        End
        Begin Section
            Height =2400
            BackColor =16252927
            Name ="Detail"
            AlternateBackColor =16777215
            Begin
                Begin OptionGroup
                    BackStyle =0
                    OverlapFlags =85
                    Left =300
                    Top =1020
                    Width =3272
                    Height =898
                    TabIndex =1
                    Name ="optPending"
                    DefaultValue ="1"
                    Tag ="2: 1.4583/.884"

                    LayoutCachedLeft =300
                    LayoutCachedTop =1020
                    LayoutCachedWidth =3572
                    LayoutCachedHeight =1918
                    Begin
                        Begin Label
                            BackStyle =1
                            OverlapFlags =215
                            TextFontFamily =34
                            Left =420
                            Top =900
                            Width =780
                            Height =285
                            BackColor =16252927
                            ForeColor =7169897
                            Name ="optPending_Label"
                            Caption ="Include:"
                            FontName ="Franklin Gothic Book"
                            Tag ="2: 1.375/.1979"
                            LayoutCachedLeft =420
                            LayoutCachedTop =900
                            LayoutCachedWidth =1200
                            LayoutCachedHeight =1185
                        End
                        Begin OptionButton
                            SpecialEffect =2
                            OverlapFlags =87
                            Left =486
                            Top =1258
                            OptionValue =1
                            Name ="Option39"
                            LayoutCachedLeft =486
                            LayoutCachedTop =1258
                            LayoutCachedWidth =746
                            LayoutCachedHeight =1498
                            Begin
                                Begin Label
                                    OverlapFlags =247
                                    TextFontFamily =34
                                    Left =716
                                    Top =1230
                                    Width =2670
                                    Height =285
                                    BackColor =16252927
                                    ForeColor =7169897
                                    Name ="Label40"
                                    Caption ="Verified detections only"
                                    FontName ="Franklin Gothic Book"
                                    LayoutCachedLeft =716
                                    LayoutCachedTop =1230
                                    LayoutCachedWidth =3386
                                    LayoutCachedHeight =1515
                                End
                            End
                        End
                        Begin OptionButton
                            SpecialEffect =2
                            OverlapFlags =87
                            Left =486
                            Top =1588
                            OptionValue =2
                            Name ="Option41"
                            LayoutCachedLeft =486
                            LayoutCachedTop =1588
                            LayoutCachedWidth =746
                            LayoutCachedHeight =1828
                            Begin
                                Begin Label
                                    OverlapFlags =247
                                    TextFontFamily =34
                                    Left =720
                                    Top =1560
                                    Width =2760
                                    Height =285
                                    BackColor =16252927
                                    ForeColor =7169897
                                    Name ="Label42"
                                    Caption ="Pending and verified detections"
                                    FontName ="Franklin Gothic Book"
                                    LayoutCachedLeft =720
                                    LayoutCachedTop =1560
                                    LayoutCachedWidth =3480
                                    LayoutCachedHeight =1845
                                End
                            End
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =93
                    TextFontCharSet =204
                    IMESentenceMode =3
                    Left =4800
                    Top =2040
                    Width =959
                    Height =314
                    TabIndex =2
                    BorderColor =7169897
                    Name ="txtMinutes"
                    AfterUpdate ="[Event Procedure]"
                    DefaultValue ="60"

                    LayoutCachedLeft =4800
                    LayoutCachedTop =2040
                    LayoutCachedWidth =5759
                    LayoutCachedHeight =2354
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextFontFamily =34
                            Left =300
                            Top =2040
                            Width =4260
                            Height =314
                            BackColor =16252927
                            ForeColor =7169897
                            Name ="txtMinutes_Label"
                            Caption ="Number of minutes between independent events:"
                            FontName ="Franklin Gothic Book"
                            LayoutCachedLeft =300
                            LayoutCachedTop =2040
                            LayoutCachedWidth =4560
                            LayoutCachedHeight =2354
                        End
                    End
                End
                Begin TextBox
                    TabStop = NotDefault
                    OverlapFlags =85
                    TextFontCharSet =204
                    IMESentenceMode =3
                    Left =7140
                    Width =0
                    Height =0
                    TabIndex =3
                    BorderColor =7169897
                    Name ="txtFocus"

                    LayoutCachedLeft =7140
                    LayoutCachedWidth =7140
                End
                Begin ComboBox
                    OverlapFlags =93
                    TextFontCharSet =204
                    IMESentenceMode =3
                    ColumnCount =2
                    Left =421
                    Top =465
                    Width =5339
                    Height =315
                    BorderColor =7169897
                    Name ="cboSpeciesID"
                    RowSourceType ="Table/Query"
                    RowSource ="SELECT Species.SpeciesID, Species.CommonName FROM Species WHERE (((Species.Speci"
                        "esID)>0)) ORDER BY Species.CommonName;"
                    ColumnWidths ="0;1440"
                    AfterUpdate ="[Event Procedure]"

                    LayoutCachedLeft =421
                    LayoutCachedTop =465
                    LayoutCachedWidth =5760
                    LayoutCachedHeight =780
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextFontFamily =34
                            Left =300
                            Top =120
                            Width =5325
                            Height =270
                            BackColor =16252927
                            ForeColor =7169897
                            Name ="lblSpeciesID"
                            Caption ="Select the species to update:"
                            FontName ="Franklin Gothic Book"
                            LayoutCachedLeft =300
                            LayoutCachedTop =120
                            LayoutCachedWidth =5625
                            LayoutCachedHeight =390
                        End
                    End
                End
                Begin TextBox
                    TabStop = NotDefault
                    OldBorderStyle =0
                    OverlapFlags =87
                    BackStyle =0
                    IMESentenceMode =3
                    Left =5760
                    Top =465
                    Width =240
                    Height =314
                    TabIndex =4
                    ForeColor =2366701
                    Name ="txtSpeciesReqd"
                    ControlSource ="=IIf([cboSpeciesID] Is Null,\"*\",\"\")"
                    OnEnter ="[Event Procedure]"

                    LayoutCachedLeft =5760
                    LayoutCachedTop =465
                    LayoutCachedWidth =6000
                    LayoutCachedHeight =779
                End
                Begin TextBox
                    TabStop = NotDefault
                    OldBorderStyle =0
                    OverlapFlags =87
                    BackStyle =0
                    IMESentenceMode =3
                    Left =5760
                    Top =2040
                    Width =240
                    Height =314
                    TabIndex =5
                    ForeColor =2366701
                    Name ="txtMinutesReqd"
                    ControlSource ="=IIf([txtMinutes] Is Null,\"*\",\"\")"
                    OnEnter ="[Event Procedure]"

                    LayoutCachedLeft =5760
                    LayoutCachedTop =2040
                    LayoutCachedWidth =6000
                    LayoutCachedHeight =2354
                End
            End
        End
        Begin FormFooter
            Height =660
            BackColor =6108695
            Name ="FormFooter"
            Begin
                Begin CommandButton
                    Default = NotDefault
                    Enabled = NotDefault
                    OverlapFlags =93
                    TextFontFamily =34
                    Left =2400
                    Top =120
                    Width =1920
                    Height =420
                    Name ="cmdAssign"
                    Caption ="Assign"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ImageData = Begin
                        0x00000000
                    End

                    LayoutCachedLeft =2400
                    LayoutCachedTop =120
                    LayoutCachedWidth =4320
                    LayoutCachedHeight =540
                End
                Begin CommandButton
                    Cancel = NotDefault
                    OverlapFlags =93
                    TextFontFamily =34
                    Left =5160
                    Top =120
                    Width =1920
                    Height =420
                    TabIndex =1
                    Name ="cmdCancel"
                    Caption ="Cancel"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ImageData = Begin
                        0x00000000
                    End

                    LayoutCachedLeft =5160
                    LayoutCachedTop =120
                    LayoutCachedWidth =7080
                    LayoutCachedHeight =540
                End
                Begin Label
                    Visible = NotDefault
                    BackStyle =1
                    OverlapFlags =215
                    TextAlign =2
                    TextFontFamily =34
                    Width =7200
                    Height =660
                    FontSize =14
                    TopMargin =115
                    BackColor =6108695
                    BorderColor =0
                    ForeColor =-2147483608
                    Name ="lblStatus"
                    Caption ="Analyzing Detections..."
                    FontName ="Trebuchet MS"
                    GridlineColor =0
                    LayoutCachedWidth =7200
                    LayoutCachedHeight =660
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private Const strGenericError As String = _
    "An error occurred while generating independent detections."


Private Sub cboSpeciesID_AfterUpdate()
'Check required fields

EnableAssign

End Sub

Private Sub cmdAssign_Click()
'Run the query to add detections and display results

On Error GoTo ErrHandler

'Disable controls
LockForm True

'Run query
MsgBox AddIndDetections(Me.cboSpeciesID, (Me.optPending = 2), _
    Me.txtMinutes) & " independent detections assigned."

'Enable controls
LockForm False
Exit Sub

ErrHandler:
    ErrorMsg strGenericError, Err.Number, Err.Description
    DoCmd.Close

End Sub

Private Sub cmdCancel_Click()
'Close the form

DoCmd.Close

End Sub

Private Sub cmdHelp_Click()
'Display help message

HelpMsg Me.Name, "Independent Detections"

End Sub

Private Sub Form_Open(Cancel As Integer)
'Make sure all controls are available

On Error GoTo ErrHandler

LockForm False
Me.cboSpeciesID.SetFocus
Exit Sub

ErrHandler:
    ErrorMsg "Unable to open the form.", _
        Err.Number, Err.Description

End Sub

Private Sub Form_Unload(Cancel As Integer)
'Prevent closing while query is running

On Error Resume Next

'Check cancel button - disabled while code is running
If Me.cmdCancel.Enabled = True Then
    'OK to close
    Cancel = False
    'Check for IndividualID form
    If IsLoaded("IndividualID") Then
        'Close and reopen form to display new records
        DoCmd.Close acForm, "IndividualID", acSaveNo
        DoCmd.OpenForm "IndividualID"
    End If
Else
    'Cancel closing the form
    Cancel = True
End If

End Sub

Private Sub txtMinutes_AfterUpdate()
'Check required fields

EnableAssign

End Sub

Private Sub txtMinutesReqd_Enter()
'Prevent clicking/tabbing into textbox

Me.txtMinutes.SetFocus

End Sub

Private Sub txtSpeciesReqd_Enter()
'Prevent clicking/tabbing into textbox

Me.cboSpeciesID.SetFocus

End Sub

'------------------------------
'Form-specific custom functions
'------------------------------

Private Function AddIndDetections(lngSpeciesID As Long, bPending As Boolean, _
    lngMinutes As Long) As Long
'Creates append query and runs it to add records to IndependentDetections
'SQL subqueries:
    'VPD1: All images with appropriate detections - one row per image
    'VPD2: All previous detections within n minutes with same species/location
    'AllIndStart: All VPD1 with no match in VPD2 - images where there is no
    'photo of that species at that location in the preceding n minutes


Dim db As DAO.Database
Dim strSubQuery As String
Dim strStatus As String
Dim strSQL As String

'Check status requirement
If bPending Then
    strStatus = "<3"
Else
    strStatus = "=2"
End If

'Build SQL for VPD1
strSubQuery = "(SELECT Photos.ImageID, First(Visits.LocationID) As " & _
    "LocationID, First(Photos.ImageDate) AS Start, " & _
    "First(Detections.SpeciesID) As SpeciesID FROM Visits INNER JOIN " & _
    "(Photos INNER JOIN Detections ON Photos.ImageID = " & _
    "Detections.ImageID) ON Visits.VisitID = Photos.VisitID WHERE " & _
    "(((Detections.StatusID)" & strStatus & ") AND " & _
    "((Detections.SpeciesID)=" & lngSpeciesID & ")) GROUP BY " & _
    "Photos.ImageID) AS VPD1 "

'Add VPD1 to final SQL statement
strSQL = strSubQuery

'Build SQL for VPD2
strSubQuery = "(SELECT Photos.ImageID, Visits.LocationID, " & _
    "Photos.ImageDate, Detections.SpeciesID FROM Visits INNER JOIN " & _
    "(Photos INNER JOIN Detections ON Photos.ImageID = " & _
    "Detections.ImageID) ON Visits.VisitID = Photos.VisitID WHERE " & _
    "(((Detections.StatusID)" & strStatus & ") AND " & _
    "((Detections.SpeciesID)=" & lngSpeciesID & "))) AS VPD2 "

'Add VPD2 and AllIndStart to final SQL statement
strSQL = strSQL & "LEFT JOIN " & strSubQuery & "ON (VPD1.LocationID = " & _
    "VPD2.LocationID) AND (((VPD1.Start > VPD2.ImageDate) AND " & _
    "(DateAdd('n', " & lngMinutes * -1 & ", VPD1.Start) < " & _
    "VPD2.ImageDate)) OR ((VPD1.Start = VPD2.ImageDate) AND " & _
    "(VPD1.ImageID > VPD2.ImageID))) WHERE (((VPD2.ImageID) Is Null))) " & _
    "AS AllIndStart "

'Add insert and select clauses
strSQL = "INSERT INTO IndependentDetections ( SpeciesID, LocationID, " & _
    "DefaultStart, ModifiedStart, Deleted ) SELECT AllIndStart.SpeciesID, " & _
    "AllIndStart.LocationID, AllIndStart.Start, AllIndStart.Start As S2, " & _
    "0 As Del FROM (SELECT VPD1.SpeciesID, VPD1.LocationID, " & _
    "VPD1.Start FROM " & strSQL

'Add left join to exclude records already added
strSQL = strSQL & "LEFT JOIN IndependentDetections ON " & _
    "(AllIndStart.LocationID = IndependentDetections.LocationID) AND " & _
    "(AllIndStart.SpeciesID = IndependentDetections.SpeciesID) AND " & _
    "(AllIndStart.Start = IndependentDetections.DefaultStart) WHERE " & _
    "(((IndependentDetections.IndDetectionID) Is Null))"

'Run SQL and return rows added
Set db = CurrentDb
db.Execute strSQL
AddIndDetections = db.RecordsAffected

End Function

Private Sub EnableAssign()
'Enable action button if required fields are populated

'Move focus if necessary
If Me.ActiveControl.Name = "cmdAssign" Then
    Me.txtFocus.SetFocus
End If

'Enable/disable button
Me.cmdAssign.Enabled = Not (IsNull(Me.cboSpeciesID) Or IsNull(Me.txtMinutes))

End Sub

Private Sub LockForm(bLocked As Boolean)
'Disable form controls while code is running

'Show status label
Me.lblStatus.Visible = bLocked
Me.txtFocus.SetFocus
'Action buttons
If bLocked Then
    Me.cmdAssign.Enabled = False
Else
    EnableAssign
End If
Me.cmdCancel.Enabled = Not bLocked
'Input controls
Me.cboSpeciesID.Enabled = Not bLocked
Me.optPending.Enabled = Not bLocked
Me.txtMinutes.Enabled = Not bLocked
'Close button
AccessCloseButtonEnabled Not bLocked
Me.Repaint

End Sub
