Version =20
VersionRequired =20
Begin Form
    PopUp = NotDefault
    RecordSelectors = NotDefault
    ShortcutMenu = NotDefault
    AutoCenter = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    PictureSizeMode =1
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =9360
    DatasheetFontHeight =11
    ItemSuffix =57
    Left =3495
    Top =2490
    Right =28545
    Bottom =15015
    RecSrcDt = Begin
        0x889c6f9a77e9e340
    End
    DatasheetFontName ="Calibri"
    FilterOnLoad =0
    DatasheetBackColor12 =16777215
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =16053492
    PictureSizeMode =4
    DatasheetGridlinesColor12 =15062992
    FitToScreen =1
    Begin
        Begin Label
            BackStyle =0
            TextFontFamily =18
            FontSize =10
            BorderColor =11644565
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Rectangle
            BackStyle =0
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Line
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Image
            BackStyle =0
            SizeMode =3
            PictureAlignment =2
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CommandButton
            TextFontFamily =18
            FontWeight =400
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =16118511
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin OptionButton
            LabelX =230
            LabelY =-30
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CheckBox
            LabelX =230
            LabelY =-30
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin OptionGroup
            BackStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin BoundObjectFrame
            SizeMode =3
            BackStyle =0
            LabelX =-1800
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin TextBox
            FELineBreak = NotDefault
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            AsianLineBreak =1
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            ShowDatePicker =1
        End
        Begin ListBox
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            AllowValueListEdits =1
            InheritValueList =1
        End
        Begin ComboBox
            LabelX =-1800
            FontSize =11
            BorderColor =11644565
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            AllowValueListEdits =1
            InheritValueList =1
        End
        Begin Subform
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin UnboundObjectFrame
            BackStyle =0
            OldBorderStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin CustomControl
            OldBorderStyle =1
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin ToggleButton
            TextFontFamily =18
            FontWeight =400
            ForeColor =7233610
            FontName ="Constantia"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =16118511
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Tab
            FontSize =11
            FontName ="Calibri"
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
        End
        Begin Attachment
            BackStyle =0
            PictureSizeMode =3
            Width =4800
            Height =3840
            BorderColor =11644565
            LeftPadding =30
            TopPadding =30
            RightPadding =30
            BottomPadding =30
            GridlineStyleLeft =0
            GridlineStyleTop =0
            GridlineStyleRight =0
            GridlineStyleBottom =0
            GridlineColor =7233610
            GridlineWidthLeft =1
            GridlineWidthTop =1
            GridlineWidthRight =1
            GridlineWidthBottom =1
            LabelX =-1800
        End
        Begin FormHeader
            Height =585
            BackColor =6108695
            Name ="FormHeader"
            AutoHeight =1
            Begin
                Begin Label
                    OverlapFlags =85
                    TextAlign =1
                    TextFontFamily =34
                    Left =300
                    Top =60
                    Width =3975
                    Height =525
                    FontSize =18
                    BackColor =6108695
                    BorderColor =5029044
                    ForeColor =-2147483608
                    Name ="Auto_Title0"
                    Caption ="Import Photo ID Module"
                    FontName ="Trebuchet MS"
                    GridlineColor =0
                    LayoutCachedLeft =300
                    LayoutCachedTop =60
                    LayoutCachedWidth =4275
                    LayoutCachedHeight =585
                End
                Begin CommandButton
                    OverlapFlags =85
                    TextFontFamily =34
                    Left =8880
                    Top =120
                    Width =366
                    Height =366
                    Name ="cmdHelp"
                    Caption ="Help"
                    StatusBarText ="Help"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ControlTipText ="Help"
                    ImageData = Begin
                        0x2800000010000000100000000100200000000000000000000000000000000000 ,
                        0x000000000000000000000000000000000000000000000000e0e8e000e0c8b000 ,
                        0xe0d8d000e0d0c010e0d0c010d0d0c010d0d0c000d0d0d000e0e0e00000000000 ,
                        0x0000000000000000000000000000000000000000f0e8e0009068303080582080 ,
                        0x905010c0804820e0804820c0804810b06040108050381030d0c8c01000000000 ,
                        0x000000000000000000000000e0780000e0a05010a0683070c08860f0e0c8b0ff ,
                        0xf0f0f0fffffffffffffffffff0f0f0ffe0c8c0ffa07850c040301060d0c8c010 ,
                        0xe0d8d0000000000000000000e0882000b0703070e0a880fffff0e0ffe0b8a0ff ,
                        0xd08050ffc05820ffc05820ffd08050ffe0b8a0fff0e8e0ffb09070f050301060 ,
                        0xd0c8c000e0e0e00000000000b0783030d09870f0fff0e0ffe0a890ffc05010ff ,
                        0xc05010ffe0a890ffffffffffb04810ffb04810ffd0a080fff0f0e0ffa07050d0 ,
                        0x50381030d0d0d000f0f0f000b0784080f0d8c0fff0c8b0ffe05820ffd05810ff ,
                        0xd05010ffe08050ffe0a880ffc05010ffb04810ffb04810ffe0b8a0ffe0c8c0ff ,
                        0x50401080d0d0d010f0f0f000d08040e0fff8f0fff09870fff06020ffe05820ff ,
                        0xe05820fff0a890ffffffffffd05010ffc05010ffb05010ffc07850fff0f0f0ff ,
                        0x804020c0e0d0c000f0f0f000d08040f0ffffffffff7840ffff6830fff06820ff ,
                        0xf06020fff08850fffffffffff0c0b0ffc05820ffb05010ffb05820ffffffffff ,
                        0x804820e0e0d0c010f0f0f000d08850f0ffffffffff8050ffff7030ffff6830ff ,
                        0xff6830ffff6820fff09060fffff8f0fff0d8c0ffc05020ffc05820ffffffffff ,
                        0x804820e0e0d8d010f0f0f000d08050c0fff8f0ffffa880ffff7040ffff8850ff ,
                        0xffb090ffff7030fff06820fff09070fffffffffff08050ffd08860fffff0f0ff ,
                        0x805820b0e0d8d010f0f0f000c0804070f0d8c0ffffd0c0ffff7840ffff9870ff ,
                        0xffffffffffc8b0ffff9060ffffc8b0fffff8f0fff07840fff0c8b0ffe0c8b0ff ,
                        0x90602070e0c8b00000000000c0884030e0a070f0fff8f0ffffc0a0ffff7840ff ,
                        0xffb8a0fffff8f0fffffffffffff0e0ffff9870fff0b8a0fffff0e0ffc08850e0 ,
                        0xa0682030f0e8e0000000000000000000c0884060e0b8a0f0fff8f0ffffd0c0ff ,
                        0xffa880ffff8850ffff8850ffffa880fff0d0c0fffff0e0ffd0a880f0a0683060 ,
                        0xe0c0a00000000000000000000000000000000000c0884060e0a070f0f0d8c0ff ,
                        0xfff8f0fffffffffffffffffffff8f0fff0d8c0ffc09060e0a0703050f0b89000 ,
                        0x0000000000000000000000000000000000000000f0f0f000c0884030c0804070 ,
                        0xe0a070c0d09870e0d09860f0d09870d0b0784070b0784020f0e8f00000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0xf0f0f000f0f0f000f0f0f000f0f0f000f0f0f00000000000f0f0f00000000000 ,
                        0x0000000000000000
                    End
                    BackStyle =0

                    LayoutCachedLeft =8880
                    LayoutCachedTop =120
                    LayoutCachedWidth =9246
                    LayoutCachedHeight =486
                End
            End
        End
        Begin Section
            Height =900
            BackColor =16252927
            Name ="Detail"
            AlternateBackColor =16777215
            Begin
                Begin TextBox
                    OverlapFlags =85
                    TextFontCharSet =204
                    IMESentenceMode =3
                    Left =421
                    Top =465
                    Width =5339
                    Height =315
                    BorderColor =7169897
                    Name ="txtModuleDB"
                    AfterUpdate ="[Event Procedure]"

                    LayoutCachedLeft =421
                    LayoutCachedTop =465
                    LayoutCachedWidth =5760
                    LayoutCachedHeight =780
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextFontFamily =34
                            Left =300
                            Top =120
                            Width =5325
                            Height =270
                            BackColor =16252927
                            ForeColor =7169897
                            Name ="txtModuleDB_Label"
                            Caption ="Select the module database:"
                            FontName ="Franklin Gothic Book"
                            LayoutCachedLeft =300
                            LayoutCachedTop =120
                            LayoutCachedWidth =5625
                            LayoutCachedHeight =390
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    TextFontFamily =34
                    Left =5880
                    Top =465
                    Width =900
                    Height =314
                    TabIndex =1
                    Name ="cmdBrowsePath"
                    Caption ="Command12"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ImageData = Begin
                        0x2800000010000000100000000100200000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000708890ff608090ff607880ff507080ff506070ff405860ff ,
                        0x404850ff303840ff203030ff202030ff101820ff101010ff101020ff00000000 ,
                        0x0000000000000000708890ff90a0b0ff70b0d0ff0090d0ff0090d0ff0090d0ff ,
                        0x0090c0ff1088c0ff1080b0ff1080b0ff2078a0ff207090ff204860ff20303050 ,
                        0x0000000000000000808890ff80c0d0ff90a8b0ff80e0ffff60d0ffff50c8ffff ,
                        0x50c8ffff40c0f0ff30b0f0ff30a8f0ff20a0e0ff1090d0ff206880ff202830b0 ,
                        0x00000000000000008090a0ff80d0f0ff90a8b0ff90c0d0ff70d8ffff60d0ffff ,
                        0x60d0ffff50c8ffff50c0ffff40b8f0ff30b0f0ff30a8f0ff1088d0ff204860ff ,
                        0x10283020000000008090a0ff80d8f0ff80c8e0ff90a8b0ff80e0ffff70d0ffff ,
                        0x60d8ffff60d0ffff60d0ffff50c8ffff40c0f0ff40b8f0ff30b0f0ff206880ff ,
                        0x10486090000000008098a0ff90e0f0ff90e0ffff90a8b0ff90b8c0ff70d8ffff ,
                        0x60d8ffff60d8ffff60d8ffff60d0ffff50d0ffff50c8ffff40b8f0ff30a0e0ff ,
                        0x406070f0506070308098a0ff90e0f0ffa0e8ffff80c8e0ff90a8b0ff80e0ffff ,
                        0x80e0ffff80e0ffff80e0ffff80e0ffff80e0ffff80e0ffff70d8ffff70d8ffff ,
                        0x50a8d0ff506070a090a0a0ffa0e8f0ffa0e8ffffa0e8ffff90b0c0ff90b0c0ff ,
                        0x90a8b0ff90a8b0ff80a0b0ff80a0b0ff8098a0ff8098a0ff8090a0ff8090a0ff ,
                        0x808890ff708890ff90a0b0ffa0e8f0ffa0f0ffffa0e8ffffa0e8ffff80d8ffff ,
                        0x60d8ffff60d8ffff60d8ffff60d8ffff60d8ffff60d8ffff708890ff00000000 ,
                        0x000000000000000090a0b0ffa0f0f0ffb0f0f0ffa0f0ffffa0e8ffffa0e8ffff ,
                        0x70d8ffff90a0a0ff8098a0ff8098a0ff8090a0ff809090ff708890ff00000000 ,
                        0x000000000000000090a8b0ffa0d0e0ffb0f0f0ffb0f0f0ffa0f0ffffa0e8ffff ,
                        0x90a0b0ff80a8b0800000000000000000000000000000000000000000906850ff ,
                        0x906850ff906850ff90a8b05090a8b0ff90a8b0ff90a8b0ff90a8b0ff90a8b0ff ,
                        0x90a8b090000000000000000000000000000000000000000000000000a0787050 ,
                        0x906850ff906850ff000000000000000000000000000000000000000000000000 ,
                        0x000000000000000000000000907860ff9068506000000000a0787010a09080ff ,
                        0xa0887050907860ff000000000000000000000000000000000000000000000000 ,
                        0x000000000000000000000000a0988040a09080ffa08880ffb09880ffa0908080 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End

                    LayoutCachedLeft =5880
                    LayoutCachedTop =465
                    LayoutCachedWidth =6780
                    LayoutCachedHeight =779
                End
                Begin TextBox
                    TabStop = NotDefault
                    OverlapFlags =85
                    TextFontCharSet =204
                    IMESentenceMode =3
                    Left =7860
                    Width =0
                    Height =0
                    TabIndex =2
                    BorderColor =7169897
                    Name ="txtFocus"

                    LayoutCachedLeft =7860
                    LayoutCachedWidth =7860
                End
            End
        End
        Begin FormFooter
            Height =660
            BackColor =6108695
            Name ="FormFooter"
            Begin
                Begin CommandButton
                    Default = NotDefault
                    Enabled = NotDefault
                    OverlapFlags =93
                    TextFontFamily =34
                    Left =3840
                    Top =120
                    Width =1920
                    Height =420
                    Name ="cmdImport"
                    Caption ="Import IDs"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ImageData = Begin
                        0x00000000
                    End

                    LayoutCachedLeft =3840
                    LayoutCachedTop =120
                    LayoutCachedWidth =5760
                    LayoutCachedHeight =540
                End
                Begin CommandButton
                    Cancel = NotDefault
                    OverlapFlags =93
                    TextFontFamily =34
                    Left =6720
                    Top =120
                    Width =1920
                    Height =420
                    TabIndex =1
                    Name ="cmdCancel"
                    Caption ="Cancel"
                    OnClick ="[Event Procedure]"
                    FontName ="Trebuchet MS"
                    ImageData = Begin
                        0x00000000
                    End

                    LayoutCachedLeft =6720
                    LayoutCachedTop =120
                    LayoutCachedWidth =8640
                    LayoutCachedHeight =540
                End
                Begin Label
                    Visible = NotDefault
                    BackStyle =1
                    OverlapFlags =215
                    TextAlign =2
                    TextFontFamily =34
                    Width =9360
                    Height =660
                    FontSize =14
                    TopMargin =115
                    BackColor =6108695
                    BorderColor =0
                    ForeColor =-2147483608
                    Name ="lblStatus"
                    Caption ="Initializing..."
                    FontName ="Trebuchet MS"
                    GridlineColor =0
                    LayoutCachedWidth =9360
                    LayoutCachedHeight =660
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private Const strGenericError As String = _
    "The module import form encountered an error."
Dim bImport As Boolean

Private Sub cmdBrowsePath_Click()
'Browse dialog for selecting photo ID database

Dim dlg As Object
Dim strFilePath As String

On Error GoTo ErrHandler

Set dlg = Application.FileDialog(msoFileDialogFilePicker)
strFilePath = ""
dlg.Filters.Add "Photo ID databases", "*.accdr"
dlg.AllowMultiSelect = False

    If dlg.Show = -1 Then
        strFilePath = dlg.SelectedItems(1)
    End If

Me.txtModuleDB = strFilePath
Call txtModuleDB_AfterUpdate

BrowseExit:
    Set dlg = Nothing
    Exit Sub

ErrHandler:
    ErrorMsg "The browse dialog triggered an error.", _
        Err.Number, Err.Description
    Resume BrowseExit

End Sub

Private Sub cmdCancel_Click()
'Close the form

On Error GoTo ErrHandler

DoCmd.Close
Exit Sub

ErrHandler:
    ErrorMsg strGenericError, Err.Number, Err.Description

End Sub

Private Sub cmdHelp_Click()
'Display help message

HelpMsg Me.Name, Me.Name & " Form Help"

End Sub

Private Sub cmdImport_Click()
'Import detections

Dim lngDetections As Long
Dim lngSpecies As Long
Dim lngObservers As Long
Dim strRunTimeDB As String
Dim strSourceFile As String
Dim strResult As String

On Error GoTo ErrHandler

'Test for correct info and existing files
If Not TestFiles() Then
    Exit Sub
End If

'Prevent changes
Me.lblStatus.Caption = "Initializing..."
LockForm
bImport = True

'Get preliminary info
strRunTimeDB = Me.txtModuleDB
DoCmd.SetWarnings False

'Change runtime database to allow access
strSourceFile = Replace(strRunTimeDB, "accdr", "accdb")
Name strRunTimeDB As strSourceFile

'Link relevant tables
Me.lblStatus.Caption = "Retrieving data..."
LinkTables strSourceFile

'Close and reopen switchboard to hide nav pane
If IsLoaded("Switchboard") Then
    DoCmd.Close acForm, "Switchboard"
    DoCmd.OpenForm "Switchboard"
    DoCmd.SetWarnings False
    DoCmd.SelectObject acForm, "ImportModule", False
    DoCmd.Restore
End If

'Get species and observer counts
lngSpecies = DCount("*", "Species")
lngObservers = DCount("*", "Observers")

'Run queries to import detections and get number of duplicates
lngDetections = RunImportQueries()
If lngDetections > 0 Then
    strResult = " (" & lngDetections & " duplicates ignored)"
Else
    strResult = ""
End If

'Compare with existing detections
Me.lblStatus.Caption = "Combining matching detections..."
CombineDetections

'Show results message
lngDetections = DCount("*", "qryModuleResults")
strResult = lngDetections & " detections were imported" & _
    strResult & ":" & vbNewLine
lngDetections = DCount("*", "qryModuleResults", "StatusID=2")
strResult = strResult & "   " & lngDetections & _
    " verified" & vbNewLine
lngDetections = DCount("*", "qryModuleResults", "StatusID=3")
strResult = strResult & "   " & lngDetections & _
    " deleted" & vbNewLine
lngDetections = DCount("*", "qryModuleResults", "StatusID=1")
strResult = strResult & "   " & lngDetections & _
    " pending" & vbNewLine
lngSpecies = DCount("*", "Species") - lngSpecies
strResult = strResult & "   " & lngSpecies & _
    " species added" & vbNewLine
lngObservers = DCount("*", "Observers") - lngObservers
strResult = strResult & "   " & lngObservers & _
    " observers added"
LockForm False
Me.lblStatus.Caption = "Cleaning up..."
UpdateFlags
MsgBox strResult

ModImportExit:
    On Error Resume Next
    'Remove links and temporary detections table
    RemoveTables
    'Set file extension back to runtime database
    Name strSourceFile As strRunTimeDB
    'Close and reopen switchboard again to make sure nav pane is hidden
    DoCmd.Close acForm, "Switchboard"
    DoCmd.OpenForm "Switchboard"
    DoCmd.SelectObject acForm, "ImportModule", False
    DoCmd.Restore
    DoCmd.SetWarnings True
    Exit Sub

ErrHandler:
    ErrorMsg "An error occurred during the import operation." & vbNewLine & _
        "Please double check your settings and try again." & vbNewLine & vbNewLine & _
        "If the error occurred partway through the procedure," & vbNewLine & _
        "it may be necessary to clean up some files or data.", _
        Err.Number, Err.Description
    If IsLoaded("ImportModule") Then
        LockForm False
    End If
    Resume ModImportExit

End Sub

Private Sub txtModuleDB_AfterUpdate()
'Enable copy button only when path is selected

On Error GoTo ErrHandler

Me.cmdImport.Enabled = Not IsNull(Me.txtModuleDB)
Exit Sub

ErrHandler:
    ErrorMsg strGenericError, Err.Number, Err.Description

End Sub

'------------------------------
'Form-specific custom functions
'------------------------------

Private Sub CreateDetectionsTable()
'Move linked detections into temporary table

Dim db As Database
Dim tdf As TableDef
Dim fld As Field
Dim bOldFormat As Boolean
Dim strSQL As String

On Error GoTo ErrHandler

Set db = CurrentDb
strSQL = "SELECT Detections.* INTO NewDetections " & _
    "FROM Detections WHERE Detections.ImageID < 0"
db.Execute strSQL

Set tdf = db.TableDefs("ModuleDetections")
For Each fld In tdf.Fields
    If fld.Name = "ObsID2" Then
        bOldFormat = True
        Exit For
    End If
Next

If bOldFormat Then
    strSQL = "INSERT INTO NewDetections ( " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID, Comments, StatusID ) SELECT " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID, Comments, 1 As Status FROM " & _
        "ModuleDetections"
    db.Execute strSQL
    strSQL = "INSERT INTO NewDetections ( " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID, Comments, StatusID ) SELECT " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID2, Comments, 1 As Status FROM " & _
        "ModuleDetections WHERE ModuleDetections." & _
        "ObsID2 Is Not Null"
    db.Execute strSQL
Else
    strSQL = "INSERT INTO NewDetections ( DetectionID, " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID, Comments, StatusID ) SELECT DetectionID, " & _
        "ImageID, SpeciesID, DetailID, Individuals, " & _
        "ObsID, Comments, StatusID FROM " & _
        "ModuleDetections"
    db.Execute strSQL
End If

CDTExit:
    Set tdf = Nothing
    Set db = Nothing
    If Err.Number > 0 Then
        Err.Raise Err.Number
    End If
    Exit Sub

ErrHandler:
    Resume CDTExit

End Sub

Private Sub LinkTables(strDB As String)
'Link to data tables in module DB

DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "Photos", "ModulePhotos"
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "Observers", "ModuleObservers"
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "ObsPhone", "ModuleObsPhone"
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "Species", "ModuleSpecies"
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "DetectionDetails", "ModuleDetails"
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "Detections", "ModuleDetections"
On Error Resume Next
DoCmd.TransferDatabase acLink, "Microsoft Access", strDB, acTable, "PhotoTags", "ModuleTags"

End Sub

Private Sub LockForm(Optional bLocked As Boolean = True)
'Prevent changes while code is running and show status

Me.txtFocus.SetFocus
AccessCloseButtonEnabled Not bLocked
Me.cmdImport.Enabled = Not bLocked
Me.cmdCancel.Enabled = Not bLocked
Me.txtModuleDB.Enabled = Not bLocked
Me.cmdBrowsePath.Enabled = Not bLocked
Me.lblStatus.Visible = bLocked
Me.Repaint
DoEvents

End Sub

Private Sub RemoveTables()
'Get rid of linked and temporary tables after import

On Error Resume Next

DoCmd.DeleteObject acTable, "NewDetections"
DoCmd.DeleteObject acTable, "ModuleDetections"
DoCmd.DeleteObject acTable, "ModuleTags"
DoCmd.DeleteObject acTable, "ModuleObsPhone"
DoCmd.DeleteObject acTable, "ModuleObservers"
DoCmd.DeleteObject acTable, "ModuleSpecies"
DoCmd.DeleteObject acTable, "ModuleDetails"
DoCmd.DeleteObject acTable, "ModulePhotos"

End Sub

Private Function RunImportQueries() As Long
'Get data from linked tables, update foreign keys,
'and add data to permanent tables

Dim lngDup As Long

'Add new observers
DoCmd.OpenQuery "qryModImportObs"
DoCmd.OpenQuery "qryModImportObsPhone"
'Add new species
DoCmd.OpenQuery "qryModImportSpecies"
'Add new details
DoCmd.OpenQuery "qryModImportDetails"
'Create temporary detections table
CreateDetectionsTable
lngDup = DCount("*", "NewDetections")
'Update ObserverID field
DoCmd.OpenQuery "qryModUpdateObs"
'Update SpeciesID
DoCmd.OpenQuery "qryModUpdateSpecies"
'Update DetailID
DoCmd.OpenQuery "qryModUpdateDetails"
'Remove detections already in main database
DoCmd.OpenQuery "qryModDeleteExisting"
DoCmd.OpenQuery "qryModDeleteMatching"
lngDup = lngDup - DCount("*", "NewDetections")
'Add records to permanent detections table
DoCmd.OpenQuery "qryModImportDetections"
'Update highlights field
DoCmd.OpenQuery "qryModUpdateHighlights"
'Set update flag in photos table
DoCmd.OpenQuery "qryModUpdateFlags"
'Return number of duplicate IDs removed
RunImportQueries = lngDup

'Import tags
On Error Resume Next
DoCmd.OpenQuery "qryModImportPhotoTags"

End Function

Private Function TestFiles() As Boolean
'Return true if database file is valid

Dim strMsg As String

TestFiles = False

'Check for valid database file
If Not FileExists(Me.txtModuleDB) Then
    strMsg = "The database you specified doesn't exist."
    GoTo TFExit
End If

TestFiles = True

TFExit:
    If TestFiles = False Then
        MsgBox strMsg, vbExclamation, "Copy Canceled."
    End If

End Function
